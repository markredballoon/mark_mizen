!function(t,e){if("function"==typeof define&&define.amd)define(["underscore","jquery","backbone","backbone.marionette"],function(i,r,o,n){t.Uberbox=e(t,i,r,o,n)});else if("undefined"!=typeof exports){var i=require("underscore"),r=require("backbone"),o=require("marionette"),n=require("jquery");e(t,i,n,r,o)}else t.Uberbox=e(t,t._,t.uberboxjQuery||t.jQuery||t.Zepto||t.ender||t.$,Backbone,Marionette)}(this,function(t,e,i,r,o){var n,s=function(t,e){return function(){return t.apply(e,arguments)}},u=function(t,e){function i(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},a={}.hasOwnProperty;n=function(t){function r(t){this.onKeyDown=s(this.onKeyDown,this),this.onItemActivated=s(this.onItemActivated,this),this.onTouchEnd=s(this.onTouchEnd,this),this.onTouchMove=s(this.onTouchMove,this),this.onTouchStart=s(this.onTouchStart,this),r.__super__.constructor.call(this,e.extend({el:i('<div class="uberbox" />').appendTo(i("body"))},t))}return u(r,t),r.instances=[],r.prototype.template=function(){return r.Templates.uberbox},r.prototype.regions={lightbox:".uberbox-lightbox-wrapper",carousel:".uberbox-carousel-wrapper",toolbar:".uberbox-toolbar-wrapper"},r.prototype.ui={},r.prototype.onTouchCancel=function(t){return t.preventDefault()},r.prototype.isAndroid=function(){return-1!==navigator.userAgent.toLowerCase().indexOf("android")},r.prototype.onTouchStart=function(t){return i(t.target).closest(".uberbox-toolbar-wrapper, .uberbox-prev, .uberbox-next").length>0?void 0:(t.preventDefault(),this.touchStartedAt={pageX:t.touches[0].pageX,pageY:t.touches[0].pageY})},r.prototype.onTouchMove=function(t){var e,i,r,o;if(this.touchStartedAt)return t.preventDefault(),o=5,r=t.touches[0],e=r.pageX-this.touchStartedAt.pageX,i=r.pageY-this.touchStartedAt.pageX,"horizontal"===this.getOption("orientation")&&Math.abs(e)>o?(this.lightbox.currentView.currentItemView.swipeHorizontally(e>0?e-o:e+o),t.preventDefault()):"vertical"===this.getOption("orientation")&&Math.abs(i)>o?(this.lightbox.currentView.currentItemView.swipeVertically(i>0?i-o:i+o),t.preventDefault()):(this.lightbox.currentView.currentItemView.swipeBack(),"mini"===this.collection.activeItem.get("description_style")||"none"===this.collection.activeItem.get("description_style")?t.preventDefault():t.stopPropagation())},r.prototype.shouldBotherWithTouch=function(t){return"horizontal"===this.getOption("orientation")&&Math.abs()>threshold||"vertical"===this.getOption("orientation")&&Math.abs(t.pageY-this.touchStartedAt.top)>threshold},r.prototype.onTouchEnd=function(t){var e,i,r,o;return r=t,o=15,r=t.changedTouches[0],e=r.pageX-this.touchStartedAt.pageX,i=r.pageY-this.touchStartedAt.pageY,"horizontal"===this.getOption("orientation")&&(e>o&&this.lightbox.currentView.currentItemView.model.prev()&&(this.lightbox.currentView.currentItemView.swipeBack(),this.lightbox.currentView.currentItemView.model.prev().activate()),-o>e&&this.lightbox.currentView.currentItemView.model.next()&&(this.lightbox.currentView.currentItemView.swipeBack(),this.lightbox.currentView.currentItemView.model.next().activate())),"vertical"===this.getOption("orientation")&&(i>o&&this.lightbox.currentView.currentItemView.model.prev()&&(this.lightbox.currentView.currentItemView.swipeBack(),this.lightbox.currentView.currentItemView.model.prev().activate()),-o>i&&this.lightbox.currentView.currentItemView.model.next()&&(this.lightbox.currentView.currentItemView.swipeBack(),this.lightbox.currentView.currentItemView.model.next().activate())),this.lightbox.currentView.currentItemView.swipeBack(),this.touchStartedAt=null},r.contentViewTypes=function(){return{image:{condition:/\.(gif|png|jpeg|jpg)$/i,"class":r.ImageObjectView},youtube:{condition:/((\(\/\/)?(www\.)?youtube\.com\/watch\?v=.+)|((\/\/)(www\.)?youtu\.be\/.*)/i,"class":r.YoutubeObjectView},vimeo:{condition:/(\/\/)?vimeo\.com\/\d+/i,"class":r.VimeoObjectView},soundcloud:{condition:/soundcloud\.com/i,"class":r.SoundcloudObjectView},bandcamp:{condition:/bandcamp\.com/i,"class":r.BandcampObjectView},iframe:{condition:/(\/|\.html|\.htm|\.php|.aspx)$/i,"class":r.IframeObjectView},gmap:{condition:/(google\.(\w+)\/maps\/)|(maps\.google\.(\w+))|(goo\.gl\/maps\/)/i,"class":r.GoogleMapsObjectView},html:{condition:function(t){return!!t.get("html")},"class":r.HTMLObjectView},ajax:{condition:function(t){return t.get("ajax")},"class":r.AJAXOBjectView},unknown:{"class":r.UnknownItemView}}},r.show=function(t,i){var o;return null==i&&(i={}),i=e.extend({current:0,orientation:"vertical",collection:new r.ItemCollection(t),carousel:!1},i),t&&t.length>0?(this.instances.push(o=new r(i)),o):void 0},r.close=function(){var t;return this.instances.length>0?(t=this.instances.pop(),r.Utils.isFullscreen()&&r.Utils.exitFullscreen(),t.remove()):void 0},r.getPixelRatio=function(){return window.devicePixelRatio>0?window.devicePixelRatio:1},r.getObjectViewType=function(t){var i,o,n,s,u;if(s=t.get("type"))return r.contentViewTypes()[s]["class"];n=r.contentViewTypes();for(s in n)if(o=n[s],i=!1,o.condition?(e.isRegExp(o.condition)&&(u=t.get("url"))&&(i=t.get("url").match(o.condition)),e.isFunction(o.condition)&&(i=o.condition(t))):i=!0,i)return o["class"];return r.contentViewTypes().unknown},r.prototype.initialize=function(){var t,o,n;return r.__super__.initialize.apply(this,arguments),this.render(),this.bindUIElements(),this.$el.addClass("uberbox-"+this.getOption("orientation")),this.showOverlay(),n=e.extend({},this.options,{root:this.$el}),delete n.el,this.lightbox.show(new r.Lightbox(n)),this.listenTo(this.lightbox.currentView,"close",function(t){return function(){return t.remove()}}(this)),this.getOption("carousel")?(i(window).width()>1024&&(this.$el.addClass("uberbox-has-carousel"),this.carousel.show(new r.Carousel(n))),i(window).on("resize.uberbox-main",function(t){return function(){return i(window).width()<1024?(t.carousel.empty(),t.$el.removeClass("uberbox-has-carousel")):t.carousel.currentView?void 0:(t.$el.addClass("uberbox-has-carousel"),t.carousel.show(new r.Carousel(n)))}}(this))):this.$(".uberbox-carousel-wrapper").remove(),this.listenTo(this.getOption("collection"),"close",function(t){return function(){return r.close()}}(this)),this.listenTo(this.getOption("collection"),"activate",this.onItemActivated),o=this.getOption("collection").at(this.getOption("current")),o.activate(),i("body").on("keydown",this.onKeyDown),t=i("html"),this.overflow=t.css("overflow"),t.css("overflow","hidden"),this.el.addEventListener("touchstart",this.onTouchStart),this.el.addEventListener("touchend",this.onTouchEnd),this.el.addEventListener("touchmove",this.onTouchMove)},r.prototype.onItemActivated=function(t){return this.toolbar.currentView&&this.stopListening(this.toolbar.currentView,"close"),this.toolbar.show(new r.ToolbarView({model:t})),this.listenTo(this.toolbar.currentView,"close",function(t){return function(){return t.close()}}(this)),t.get("loaded")||this.showLoader(),this.oldActiveItem&&this.stopListening(this.oldActiveItem,"load"),this.oldActiveItem=t,this.listenTo(t,"load",function(t){return function(){return t.hideLoader()}}(this))},r.prototype.hideLoader=function(){return this.showLoaderTimeout&&(clearTimeout(this.showLoaderTimeout),this.showLoaderTimeout=null),this.$el.find("div.uberbox-loader").remove()},r.prototype.showLoader=function(){return this.showLoaderTimeout?void 0:this.showLoaderTimeout=setTimeout(function(t){return function(){return t.$el.append(i('<div class="uberbox-loader uberbox-icon-arrows-ccw">'))}}(this),100)},r.prototype.remove=function(){return this.trigger("close"),r.__super__.remove.apply(this,arguments),r.Utils.isFullscreen()&&r.Utils.exitFullscreen(),this.ui.overlay.removeClass("visible"),i("body").off("keydown.uberbox",this.onKeyDown),i("html").css("overflow",this.overflow),this.el.removeEventListener("touchstart",this.onTouchStart),this.el.removeEventListener("touchend",this.onTouchEnd),this.el.removeEventListener("touchmove",this.onTouchMove),setTimeout(function(t){return function(){return t.ui.overlay.remove()}}(this),600)},r.prototype.onKeyDown=function(t){return 27===t.which&&(t.preventDefault(),this.remove()),37===t.which||38===t.which?(this.collection.activatePrev(),!1):40===t.which||39===t.which?(this.collection.activateNext(),!1):void 0},r.prototype.showOverlay=function(){return this.ui.overlay=i('<div class="uberbox-overlay" />').appendTo(i("body")),e.defer(function(t){return function(){return t.ui.overlay.addClass("visible")}}(this)),this.ui.overlay.on("click",function(t){return function(){return t.remove()}}(this))},r}(o.LayoutView),n.Utils=function(){function t(){}return t.supportsFullScreen=function(){var t,e,i,r,o;if(t=document.documentElement,t.requestFullscreen)return!0;for(o=["moz","webkit","ms"],e=0,i=o.length;i>e;e++)if(r=o[e],t[r+"RequestFullScreen"])return!0;return!1},t.isFullscreen=function(){var t,i,r,o;for(o=["fullscreenEnabled","webkitFullscreenEnabled","mozFullscreenEnabled","msFullscreenEnabled"],t=0,i=o.length;i>t;t++)if(r=o[t],!e.isUndefined(document[r]))return document[r]},t.enterFullscreen=function(t){var e;return t||(t=document.documentElement),e=t.requestFullScreen||t.webkitRequestFullScreen||t.mozRequestFullScreen||t.msRequestFullScreen,e.apply(t)},t.exitFullscreen=function(){var t,e;return t=document.documentElement,e=t.exitFullscreen||t.mozCancelFullScreen||t.msExitFullscreen,e&&e.apply(t),document.webkitExitFullscreen?document.webkitExitFullscreen():void 0},t.notification=function(t){var r;return r=i('<div class="uberbox-notification" />').html(t.message).appendTo(i("body")),e.defer(function(t){return function(){return r.addClass("uberbox-active")}}(this)),setTimeout(function(t){return function(){return r.removeClass("uberbox-active"),setTimeout(function(){return r.remove()},600)}}(this),4e3)},t}();var u=function(t,e){function i(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},a={}.hasOwnProperty;n.ShareService=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.services={facebook:{url:"//www.facebook.com/share.php?v=4&src=bm&u=%url%",name:"Facebook"},twitter:{url:"//twitter.com/home?status=%url%",name:"Twitter"},googleplus:{url:"//plus.google.com/share?url=%url%",name:"Google Plus"},reddit:{url:"//reddit.com/submit?url=%url%",name:"Reddit"},digg:{url:"//digg.com/submit?phase=2&url=%url%",name:"Digg"},stumbleupon:{url:"http://www.stumbleupon.com/submit?url=%url%&title=%title%",name:"Stumbleupon"},delicious:{url:"//delicious.com/post?url=%url%",name:"Delicious"},pinterest:{url:"https://www.pinterest.com/pin/create/button/?url=%url%&media=%image_url%&description=%description%&title=%title%",name:"Pinterest"},vk:{url:"http://vk.com/share.php?url=%url%",name:"VK"}},e.prototype.processPseudotags=function(t,e){var i,r;r={url:window.location.href,image_url:e.get("url"),title:e.get("title")||"",description:e.get("description")||""};for(i in r)t=t.replace("%"+i+"%",encodeURIComponent(r[i]));return t},e.prototype.getShareLinkUrl=function(t){return this.processPseudotags(this.get("url"),t)},e}(r.Model),n.Item=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return u(i,t),i.prototype.defaults={description_style:"mini",download_tooltip:"Download",download_started_tooltip:"Download started",share_tooltip:"Share",fullscreen_tooltip:"Fullscreen",exit_fullscreen_tooltip:"Exit fullscreen"},i.prototype.initialize=function(){var t;return i.__super__.initialize.apply(this,arguments),(t=this.get("share"))&&(e.isBoolean(t)&&(t=n.ShareService.services),this.set("share",e.map(t,function(t,i){return new n.ShareService(e.extend({},{slug:i},t))}))),this.get("title")||this.get("description")?void 0:this.set("description_style","none")},i.prototype.activate=function(){return this.collection.activeItem!==this?this.trigger("activate",this):void 0},i.prototype.deactivate=function(){return this.trigger("deactivate")},i.prototype.next=function(){return this.collection.next(this)},i.prototype.prev=function(){return this.collection.prev(this)},i.prototype.isActive=function(){return this.collection.activeItem===this},i.prototype.isNext=function(){return this.collection.activeItem===this.prev()},i.prototype.isPrev=function(){return this.collection.activeItem===this.next()},i.prototype.showDescription=function(){return"none"===this.get("description_style")?!1:!!this.get("description")},i.prototype.follows=function(t){var e;return e=t.next(),e===this?!0:e?this.follows(e):!1},i.prototype.precedes=function(t){var e;return e=t.prev(),e===this?!0:e?this.precedes(e):!1},i}(r.Model),n.ItemCollection=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.prototype.model=n.Item,e.prototype.current=null,e.prototype.initialize=function(){return e.__super__.initialize.apply(this,arguments),this.on("activate",function(t){return function(e){return t.activeItem&&t.activeItem.deactivate(),t.activeItem=e}}(this))},e.prototype.next=function(t){var e;return e=this.indexOf(t),e===this.length-1?null:this.at(e+1)},e.prototype.prev=function(t){var e;return e=this.indexOf(t),0!==e?this.at(e-1):void 0},e.prototype.activateNext=function(){return this.activeItem&&this.activeItem.next()?this.activeItem.next().activate():void 0},e.prototype.activatePrev=function(){return this.activeItem&&this.activeItem.prev()?this.activeItem.prev().activate():void 0},e}(r.Collection);var s=function(t,e){return function(){return t.apply(e,arguments)}},u=function(t,e){function i(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},a={}.hasOwnProperty;n.SlidingWindowItem=function(t){function i(){return this.onClicked=s(this.onClicked,this),this.enableTransition=s(this.enableTransition,this),i.__super__.constructor.apply(this,arguments)}return u(i,t),i.prototype.loaded=!1,i.prototype.events=function(){return{click:"onClicked"}},i.prototype.modelEvents={activate:"onItemActivated",deactivate:"onItemDeactivated"},i.prototype.belongs=function(){return this.top>0&&this.left>0&&this.width+this.left<this.getParent().width()&&this.top+this.height<this.getParent().height()},i.prototype.initialize=function(){return i.__super__.initialize.apply(this,arguments),this.listenToOnce(this,"load",function(t){return function(){return t.loaded=!0,t.model.trigger("load"),t.layout(),e.defer(function(){return t.enableTransition(),t.$el.addClass("uberbox-loaded")})}}(this)),this.render(),this.bindUIElements(),this.showRegions?this.showRegions():void 0},i.prototype.getTemplate=function(){return this.getOption("template")()},i.prototype.enableTransition=function(){return this.$el.addClass("uberbox-enable-transition")},i.prototype.getNextToScrollTo=function(t){var e;return this.model===t?this:(e=this.getOption("next"))?e.getNextToScrollTo(t):null},i.prototype.getPrevToScrollTo=function(t){var e;return this.model===t?this:(e=this.getOption("prev"))?e.getPrevToScrollTo(t):null},i.prototype.runAction=function(t){return this.loaded?t():this.listenToOnce(this,"load",function(e){return function(){return t()}}(this))},i.prototype.getParent=function(){return this.parent||(this.parent=this.$el.parent()),this.parent},i.prototype.isNext=function(){return this.model.follows(this.model.collection.activeItem)},i.prototype.isPrev=function(){return this.model.precedes(this.model.collection.activeItem)},i.prototype.isCurrent=function(){return this.model.isActive()},i.prototype.remove=function(){return this.$el.removeClass("uberbox-visible"),this.getOption("next")&&(this.getOption("next").options.prev=null),this.getOption("prev")&&(this.getOption("prev").options.next=null),setTimeout(function(t){return function(){return i.__super__.remove.call(t)}}(this),600)},i.prototype.reveal=function(){},i.prototype.bindUIElements=function(){return i.__super__.bindUIElements.apply(this,arguments),this.model.collection.activeItem===this.model?this.onItemActivated():void 0},i.prototype.onItemActivated=function(){return this.$el.addClass("uberbox-current")},i.prototype.onItemDeactivated=function(){return this.$el.removeClass("uberbox-current")},i.prototype.onClicked=function(){return this.model.activate()},i}(o.LayoutView);var u=function(t,e){function i(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},a={}.hasOwnProperty;n.SlidingWindow=function(t){function r(t){r.__super__.constructor.call(this,e.extend({},e.result(this,"defaults"),t)),this.listenTo(this.collection,"activate",this.onItemActivated)}return u(r,t),r.prototype.defaults=function(){return{orientation:"vertical",current:0}},r.prototype.onShow=function(){return i(window).on("resize",this.layout)},r.prototype.remove=function(){return i(window).off("resize",this.layout),r.__super__.remove.apply(this,arguments)},r.prototype.getChildView=function(t){var e;return e=this.getOption("childView")},r.prototype.createChildView=function(t,i){var r,n;return null==i&&(i={}),n=this.getChildViewClass(),i=e.extend(e.extend({model:t,orientation:this.getOption("orientation")},o._getValue(this.getOption("childViewOptions"),this,[t])),i),r=new n(i),i.prev&&!i.next?(i.prev.options.next=r,r.$el.insertAfter(i.prev.$el)):i.next&&!i.prev?(i.next.options.prev=r,r.$el.insertBefore(i.next.$el)):r.$el.appendTo(this.$el),r},r}(o.View);var u=function(t,e){function i(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},a={}.hasOwnProperty,s=function(t,e){return function(){return t.apply(e,arguments)}};n.CarouselItem=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return u(i,t),i.prototype.template=function(){return n.Templates["carousel-item"]},i.prototype.className="uberbox-carousel-item",i.prototype.padding=15,i.prototype.ui={image:"img"},i.prototype.getImageAspectRatio=function(){var t,e;return e=this.ui.image[0],t=e.naturalWidth/e.naturalHeight},i.prototype.getHeightInVerticalMode=function(){return this.width/this.getImageAspectRatio()},i.prototype.getWidthInHorizontalMode=function(){return this.height*this.getImageAspectRatio()},i.prototype.bindUIElements=function(){return i.__super__.bindUIElements.apply(this,arguments),this.ui.image[0].complete&&e.defer(function(t){return function(){return t.trigger("load")}}(this)),this.$el.find("img").on("load",function(t){return function(){return t.trigger("load")}}(this))},i.prototype.layoutContent=function(){},i.prototype.hideLoader=function(){return this.ui.loader.remove()},i.prototype.layout=function(){return this.model.isActive()?this.calculateCoordinatesAsCurrent():this.model.follows(this.model.collection.activeItem)?this.calculateCoordinatesAsNext():this.model.precedes(this.model.collection.activeItem)&&this.calculateCoordinatesAsPrev(),this.loaded&&this.layoutContent(),this.applyLayout()},i.prototype.getNext=function(){return this.getOption("next")},i.prototype.getPrev=function(){return this.getOption("prev")},i.prototype.remove=function(){var t,e;return this.$el.find("img").off("load",this.onImageLoaded),this.$el.remove(),(t=this.getOption("next"))&&(t.options.prev=null),(e=this.getOption("prev"))?e.options.next=null:void 0},i.prototype.fits=function(){return this.belongs()?!0:this.top<this.getParent().height()&&this.top+this.$el.height()>0&&this.left+this.$el.width()>0&&this.left<this.getParent().width()&&this.top<this.getParent().height()?!0:!1},i.prototype.applyLayout=function(){return this.$el.css({left:this.left,top:this.top,width:this.width,height:this.height})},i}(n.SlidingWindowItem),n.VerticalCarouselItem=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.prototype.calculateCoordinatesAsPrev=function(){var t;if(t=this.getOption("next"))return this.left=this.padding,this.width=this.getParent().width()-2*this.padding,this.height=this.getHeightInVerticalMode(),this.top=t.top-this.padding-this.height},e.prototype.calculateCoordinatesAsNext=function(){var t;if(t=this.getOption("prev"))return this.left=this.padding,this.top=this.padding+t.top+t.height,this.width=this.getParent().width()-2*this.padding,this.height=this.getHeightInVerticalMode()},e.prototype.calculateCoordinatesAsCurrent=function(){var t;return this.width=this.getParent().width()-2*this.padding,this.height=this.getHeightInVerticalMode(),t=this.getParent().height()/2-this.height/2,this.left=this.padding,this.top=t},e}(n.CarouselItem),n.HorizontalCarouselItem=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.prototype.calculateCoordinatesAsPrev=function(){var t;if(t=this.getOption("next"))return this.height=this.getParent().height()-2*this.padding,this.width=this.getWidthInHorizontalMode(),this.left=t.left-this.width-this.padding,this.top=this.padding},e.prototype.calculateCoordinatesAsNext=function(){var t;if(t=this.getOption("prev"))return this.left=t.left+t.width+this.padding,this.top=this.padding,this.height=this.getParent().height()-2*this.padding,this.width=this.getWidthInHorizontalMode()},e.prototype.calculateCoordinatesAsCurrent=function(){return this.height=this.getParent().height()-2*this.padding,this.width=this.getWidthInHorizontalMode(),this.left=this.getParent().width()/2-this.width/2,this.top=this.padding},e}(n.CarouselItem),n.Carousel=function(t){function e(){return this.layout=s(this.layout,this),this.waitForFirst=s(this.waitForFirst,this),this.waitForLast=s(this.waitForLast,this),this.buildPrev=s(this.buildPrev,this),this.buildNext=s(this.buildNext,this),e.__super__.constructor.apply(this,arguments)}return u(e,t),e.prototype.className="uberbox-carousel-content",e.prototype.template=function(){return n.Templates["carousel-content"]},e.prototype.render=function(){return this.$el.html(o.Renderer.render(this.template))},e.prototype.getChildViewClass=function(){return"vertical"===this.getOption("orientation")?n.VerticalCarouselItem:n.HorizontalCarouselItem},e.prototype.hide=function(){var t;if(this.currentItemView){for(this.currentItemView.remove(),t=this.currentItemView;t=t.getOption("next");)t.remove();for(t=this.currentItemView;t=t.getOption("prev");)t.remove();return this.currentItemView=null}},e.prototype.build=function(t){},e.prototype.buildNext=function(t){var e;return this.belongs(t)&&t.model.next()&&!t.getNext()?(e=this.createChildView(t.model.next(),{prev:t}),e.runAction(function(t){return function(){return e.layout(),t.buildNext(e)}}(this))):void 0},e.prototype.buildPrev=function(t){var e;return this.belongs(t)&&t.model.prev()&&!t.getPrev()?(e=this.createChildView(t.model.prev(),{next:t}),e.runAction(function(t){return function(){return e.layout(),t.buildPrev(e)}}(this))):void 0},e.prototype.waitForLast=function(t,e){return t.runAction(function(i){return function(){return t.getNext()?i.waitForLast(t.getNext(),e):e(t)}}(this))},e.prototype.waitForFirst=function(t,e){return t.runAction(function(i){return function(){return t.getPrev()?i.waitForFirst(t.getPrev(),e):e(t)}}(this))},e.prototype.isHorizontal=function(){return"horizontal"===this.getOption("orientation")},e.prototype.fits=function(t){var e,i,r;return i=this.$el.parent(),this.isHorizontal()?(r=i.width(),this.translateX+t.left+t.width>0&&this.translateX+t.left<r):(e=i.height(),this.translateY+t.top+t.height>0&&this.translateY+t.top<e)},e.prototype.belongs=function(t){var e,i,r;return i=this.$el.parent(),this.isHorizontal()?(r=i.width(),this.translateX+t.left+t.width<r&&this.translateX+t.left>0):(e=i.height(),this.translateY+t.top+t.height<e&&this.translateY+t.top>0)},e.prototype.translateToCurrent=function(){var t;return this.isHorizontal()?(t=this.currentItemView.left,this.translateX=this.$el.parent().width()/2-t-this.currentItemView.$el.width()/2,this.$el.css({transform:"translate("+this.translateX+"px, 0px)"})):(t=this.currentItemView.top,this.translateY=this.$el.parent().height()/2-t-this.currentItemView.$el.height/2,this.$el.css({transform:"translate(0px, "+this.translateY+"px)"}))},e.prototype.layout=function(){return this.currentItemView||(this.currentItemView=this.createChildView(this.collection.activeItem)),this.currentItemView.runAction(function(t){return function(){return t.translateToCurrent(),t.waitForLast(t.currentItemView,function(e){var i;if(e&&!t.fits(e)){for(i=[];e&&!t.fits(e);)e.remove(),i.push(e=e.getPrev());return i}return t.buildNext(e)}),t.waitForFirst(t.currentItemView,function(e){var i;if(e&&!t.fits(e)){for(i=[];e&&!t.fits(e);)e.remove(),i.push(e=e.getNext());return i}return t.buildPrev(e)})}}(this))},e.prototype.onItemActivated=function(t){var e,i;if(!this.currentItemView||t!==this.currentItemView.model){if(!this.currentItemView)return this.currentItemView=this.createChildView(t),this.currentItemView.layout(),void this.layout();if(e=this.currentItemView.getNextToScrollTo(t))return this.currentItemView=e,this.layout();if(i=this.currentItemView.getPrevToScrollTo(t))return this.currentItemView=i,this.layout();for(this.currentItemView.remove(),e=this.currentItemView.getOption("next");e;)e.remove(),e=e.getOption("next");for(i=this.currentItemView.getOption("prev");i;)i.remove(),i=i.getOption("prev");return this.currentItemView.layout(),this.currentItemView=this.createChildView(t),this.layout()}},e}(n.SlidingWindow);var u=function(t,e){function i(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},a={}.hasOwnProperty;n.ToolbarView=function(t){function r(){return r.__super__.constructor.apply(this,arguments)}return u(r,t),r.prototype.template=function(){return n.Templates.toolbar},r.prototype.getTemplate=function(){return this.template()},r.prototype.className="uberbox-toolbar",r.prototype.ui={download:"*[data-action=download]",fullscreen:"*[data-action=fullscreen]",exitFullscreen:"*[data-action=exit-fullscreen]",close:"*[data-action=close]",share:"*[data-action=share]",shareMenu:".uberbox-share-menu"},r.prototype.events={"click @ui.fullscreen":"onFullscreenClick","click @ui.exitFullscreen":"onExitFullscreenClick","click @ui.close":"onCloseClick","click @ui.share":"onShareClick","click @ui.download":"onDownloadClick","click .uberbox-share-overlay":"onShareClick"},r.prototype.serializeData=function(){return{model:this.model}},r.prototype.onShow=function(){return e.defer(function(t){return function(){return t.$el.addClass("uberbox-visible")}}(this))},r.prototype.onFullscreenClick=function(t){return t.preventDefault(),t.stopPropagation(),this.ui.fullscreen.addClass("uberbox-disabled"),this.ui.exitFullscreen.removeClass("uberbox-disabled"),n.Utils.enterFullscreen(document.documentElement)},r.prototype.onDownloadClick=function(t){return n.Utils.notification({message:this.model.get("download_started_tooltip")})},r.prototype.onExitFullscreenClick=function(t){return t.preventDefault(),t.stopPropagation(),this.ui.exitFullscreen.addClass("uberbox-disabled"),this.ui.fullscreen.removeClass("uberbox-disabled"),n.Utils.exitFullscreen()},r.prototype.onCloseClick=function(t){return t.preventDefault(),t.stopPropagation(),this.model.trigger("close")},r.prototype.onShareClick=function(t){return this.ui.share.hasClass("uberbox-active")?(this.ui.share.find(".uberbox-share-overlay").removeClass("uberbox-active"),this.ui.shareMenu.removeClass("uberbox-active"),setTimeout(function(t){return function(){return t.ui.share.find(".uberbox-share-overlay").remove(),t.ui.share.removeClass("uberbox-active")}}(this),300)):(this.ui.share.append(i('<div class="uberbox-share-overlay">')),this.ui.share.addClass("uberbox-active"),e.defer(function(t){return function(){return t.ui.share.find(".uberbox-share-overlay").addClass("uberbox-active"),t.ui.shareMenu.addClass("uberbox-active")}}(this)))},r}(o.ItemView);var c,s=function(t,e){return function(){return t.apply(e,arguments)}},u=function(t,e){function i(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},a={}.hasOwnProperty;c=function(t){function e(){return this.onObjectLoaded=s(this.onObjectLoaded,this),this.onObjectError=s(this.onObjectError,this),this.fadeIn=s(this.fadeIn,this),e.__super__.constructor.apply(this,arguments)}return u(e,t),e.prototype.supportsOversizing=!1,e.prototype.fadeIn=function(){return this.visible=!0,this.$el.addClass("uberbox-visible")},e.prototype.getAspectRatio=function(){return this.$el.width()/this.$el.height()},e.prototype.isObjectLoaded=function(){},e.prototype.getObjectNaturalAspectRatio=function(){},e.prototype.layoutOversized=function(){},e.prototype.getTemplate=function(){return this.getOption("template")()},e.prototype.getWidth=function(){return this.$el.width()},e.prototype.getObjectNaturalAspectRatio=function(){return this.getObjectNaturalWidth()/this.getObjectNaturalHeight()},e.prototype.onObjectError=function(){return this.trigger("error")},e.prototype.onObjectLoaded=function(){return this.trigger("load")},e.prototype.serializeData=function(){return{model:this.model}},e.prototype.getOffset=function(){var t;return t=this.$el.offset(),t.top-=i(window).scrollTop(),t},e}(o.ItemView),n.ImageObjectView=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.prototype.className="uberbox-image-content",e.prototype.waitForLoad=!0,e.prototype.supportsOversizing=!0,e.prototype.template=function(){return n.Templates["content-image"]},e.prototype.ui={image:"img"},e.prototype.bindUIElements=function(){return e.__super__.bindUIElements.apply(this,arguments),this.isObjectLoaded()&&this.onObjectLoaded(),this.ui.image.one("load.uberbox",this.onObjectLoaded),this.ui.image.one("error.uberbox",this.onObjectError)},e.prototype.unbindUIElements=function(){return this.ui.image.off("load.uberbox"),this.ui.image.off("error.uberbox"),e.__super__.unbindUIElements.apply(this,arguments)},e.prototype.getObjectWidth=function(){return this.ui.image.width()},e.prototype.isObjectLoaded=function(){return this.ui.image[0].complete},e.prototype.getObjectNaturalWidth=function(){return this.ui.image[0].naturalWidth},e.prototype.getObjectNaturalHeight=function(){return this.ui.image[0].naturalHeight},e.prototype.getOffset=function(){var t;return t=this.ui.image.offset(),{left:t.left,top:t.top-i(window).scrollTop()}},e.prototype.getWidth=function(){return this.ui.image.width()},e}(c),n.IframeObjectView=function(t){function r(){return this.onWindowResized=s(this.onWindowResized,this),r.__super__.constructor.apply(this,arguments)}return u(r,t),r.prototype.waitForLoad=!0,r.prototype.supportsOversizing=!1,r.prototype.className="uberbox-iframe-content",r.prototype.ui={iframe:"iframe"},r.prototype.template=function(){return n.Templates["content-iframe"]},r.prototype.bindUIElements=function(){return r.__super__.bindUIElements.apply(this,arguments),this.ui.iframe.one("load.uberbox",this.onObjectLoaded),this.isObjectLoaded()&&this.onObjectLoaded(),i(window).on("resize.uberbox",this.onWindowResized),e.defer(function(t){return function(){return t.onWindowResized()}}(this))},r.prototype.unbindUIElements=function(){return this.ui.iframe.off("load.uberbox"),i(window).off("resize.uberbox")},r.prototype.getObjectWidth=function(){return this.ui.iframe.width()},r.prototype.isObjectLoaded=function(){return this.ui.iframe[0].complete},r.prototype.serializeData=function(){return e.extend(r.__super__.serializeData.apply(this,arguments),{url:this.getIframeUrl()})},r.prototype.onWindowResized=function(){return this.ui.iframe.height(Math.min(this.ui.iframe.width()/this.getObjectNaturalAspectRatio(),this.$el.height()))},r.prototype.getIframeUrl=function(){return this.model.get("url")},r.prototype.getObjectNaturalWidth=function(){return this.$el.parent().width()},r.prototype.getObjectNaturalHeight=function(){return this.$el.parent().height()},r}(c),n.YoutubeObjectView=function(t){function e(){